description: OCSF to CEF Conversion Pipeline
enabled: true
groups:
  cef_group:
    name: CEF Serialization
    description: Convert OCSF logs to CEF format
    index: 9
    functions:
      - id: eval_rename_fields
        type: Eval
        enabled: true
        conf:
          expressions:
            device_vendor: '"Amazon"'
            device_product: 'metadata?.product?.name || "UnknownProduct"'
            device_version: 'metadata?.product?.version || "1.0"'
            signature_id: 'event_name || metadata?.feature?.name || "unknownEvent"'
            name: 'event_name || metadata?.feature?.name || "unknownEvent"'
            severity: 'severity_id?.toString() || "5"'
      - id: serialize_cef
        type: SerializeCEF
        enabled: true
        conf:
          cefVersion: '0'
          deviceVendor: '${device_vendor}'
          deviceProduct: '${device_product}'
          deviceVersion: '${device_version}'
          signatureID: '${signature_id}'
          name: '${name}'
          severity: '${severity}'
          extensions:
            - src: "src_endpoint?.ip"
              key: "src"
            - src: "dst_endpoint?.ip"
              key: "dst"
            - src: "time"
              key: "start"
            - src: "actor?.user?.name"
              key: "suser"
            - src: "actor?.session?.id"
              key: "cs1"
            - src: "metadata?.event_code"
              key: "eventId"
      - id: set_output_fields
        type: Eval
        enabled: true
        conf:
          expressions:
            _raw: 'output'
            sourcetype: '"aws:ocsf:cef"'
            source: '"aws:ocsf"'
            index: '"default"'
            cribl_pipe: '"ocsf_to_cef"'
